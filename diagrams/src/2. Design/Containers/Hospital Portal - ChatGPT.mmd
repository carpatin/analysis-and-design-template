flowchart TB
%% Hospital Portal â€“ Container Diagram (Mermaid, top-to-bottom)

%% === Styles ===
    classDef person fill:#fef6e4,stroke:#333,stroke-width:1px;
    classDef container fill:#e6f7ff,stroke:#1e90ff,stroke-width:1px;
    classDef db fill:#fff0f0,stroke:#c0392b,stroke-width:1px,stroke-dasharray:4 3;
    classDef queue fill:#f0fff4,stroke:#27ae60,stroke-width:1px,stroke-dasharray:4 3;
    classDef external fill:#f5f5f5,stroke:#888,stroke-width:1px,stroke-dasharray:5 3;

%% === People ===
    medic["Person: Medic"]:::person
    nurse["Person: Nurse"]:::person

%% === System Boundary: Hospital Portal ===
    subgraph hp[Hospital Portal]
        direction TB
        mobile["Container: Healthcare Mobile App<br>iOS/Android (React Native)<br>Allows medics and nurses to manage pre-/bedside-/post-round duties."]:::container
        apigw["Container: API Gateway<br>Kong / NGINX<br>Single entry point for mobile app; routing, rate limiting, auth enforcement."]:::container
        api_auth["Container: Auth Service<br>Node.js<br>OIDC/OAuth2, tokens, user sessions, roles."]:::container
        api_patient["Container: Patient Service<br>Java/Spring Boot<br>Patient profiles, vitals, labs, attachments."]:::container
        api_rounds["Container: Rounding Service<br>Python/FastAPI<br>Task lists, checklists, notes for rounds."]:::container
        api_notify["Container: Notification Service<br>Go<br>Push notifications and SMS."]:::container
        db_core[("ContainerDb: Core Database<br>PostgreSQL<br>Operational data for services.")]:::db
        queue_notify[["ContainerQueue: Notifications queue"]]:::queue
    end

%% === External System: HIS ===
    subgraph his["External: Hospital Information System"]
        direction TB
        his_api["External Container: HIS API<br>External API<br>Supports limited data access"]:::external
        his_db[("External DB: HIS DB<br>MS SQLServer<br>Hospital Information System")]:::external
    end

%% === Other Externals ===
    push["External: Push Message <br> Provider<br>APN/FCM"]:::external
    sms["External: SMS Gateway<br>Twilio/Nexmo/...<br>External service for sending SMS messages"]:::external

%% === Relationships ===
    medic -- "Uses<br>iOS/Android app" --> mobile
    nurse -- "Uses<br>iOS/Android app" --> mobile

    mobile -- "API calls<br>HTTPS/JSON + JWT" --> apigw

    apigw -- "Authenticate/Authorize<br>gRPC/HTTP" --> api_auth
    apigw -- "Route patient requests<br>gRPC/HTTP" --> api_patient
    apigw -- "Route rounds requests<br>gRPC/HTTP" --> api_rounds
    apigw -- "Route notification requests<br>gRPC/HTTP" --> api_notify

    api_auth -- "Read/Write users, tokens<br>SQL" --> db_core
    api_patient -- "Read/Write patient data<br>SQL" --> db_core
    api_rounds -- "Read/Write tasks/notes<br>SQL" --> db_core

    api_patient -- "Fetch labs, orders, results<br>SQL" --> his_db
    api_patient -- "Fetch EHRs<br>SQL" --> his_db
    api_rounds -- "Fetch orders<br>SQL" --> his_db
    api_patient -- "Load partial patient data<br>HTTPS/JSON" --> his_api

    api_notify -- "Send push messages<br>HTTPS" --> push
    api_notify -- "Send SMS messages<br>HTTPS" --> sms
    api_notify -- "Enqueue notification<br>AMQP" --> queue_notify
    queue_notify -- "Process notification<br>AMQP" --> api_notify
